<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pi BTC Weather Clock</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* NEWS TICKER FIX */
    #news-ticker {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 30px;
      overflow: hidden;
      background: linear-gradient(90deg, #8e2de2, #4a00e0);
      color: white;
      font-size: 1.2rem;
      white-space: nowrap;
      line-height: 30px;
      z-index: 9999;
      display: none; /* Start hidden */
    }

    #news-items {
      display: inline-block;
      padding-left: 100%;
      animation: scrollNews 60s linear infinite;
    }

    @keyframes scrollNews {
      0% {
        transform: translateX(0%);
      }
      100% {
        transform: translateX(-100%);
      }
    }

    /* OPTIONAL: add small padding so content not hidden under ticker */
    #shell {
      padding-top: 30px;
    }
  </style>
</head>
<body>

<!-- RGB Background Canvas -->
<canvas id="rgbBackground"></canvas>

<!-- News Ticker -->
<div id="news-ticker">
  <div id="news-items">
    ü•ï Loading news... ü•ï
  </div>
</div>

<!-- Carrot Rain Layer -->
<div id="carrot-container"></div>

<!-- Weather Effects -->
<div id="weather-effects">
  <div class="rain-layer"></div>
  <div class="snow-layer"></div>
  <div class="wind-layer"></div>
  <div id="carrot-layer"></div>
  <div id="cloud-layer"></div> 
</div>

<!-- Main App -->
<div id="shell">
  <div class="main-grid">
    <div class="left-column">
 
 <!-- Time, Date, Current, Crypto, Stock, Alerts -->
<div id="time-data" class="info-card">
  <div id="time">--:--:--</div>
  <div id="date">--/--/----</div>
  <div id="currentTemp">Temperature: --¬∞F</div>
  <div id="btcprice">BTC: $--</div>
  <div id="stockData">Loading stock data...</div>
  <div id="weatherAlerts">Loading weather alerts...</div>

  <!-- Live 5-Day Forecast -->
  <div id="five-day-forecast">
    <!-- Will be filled dynamically by JS -->
  </div>
</div>

      <!-- Tetris -->
      <div id="tetris-wrapper" style="display: none;">
        <div id="tetris-container">
          <canvas id="tetris" width="200" height="400" style="background: rgba(0,0,0,0.8);"></canvas>

          <div id="scoreboard">
            <div>Score: <span id="score">0</span></div>
            <div>High Score: <span id="highScore">0</span></div>
          </div>

          <div id="touch-controls">
            <button id="left-btn">‚¨ÖÔ∏è</button>
            <button id="rotate-btn">üîÑ</button>
            <button id="right-btn">‚û°Ô∏è</button>
            <button id="down-btn">‚¨áÔ∏è</button>
          </div>

          <div id="highscores">
            <h2>üèÜ High Scores üèÜ</h2>
            <table id="highscore-table"></table>
          </div>
        </div>
      </div>
    </div>

  </div>

<!-- Floating Spotify Player -->

<div id="spotifyPlayer" style="display: none; position: fixed; bottom: 300px; right: 20px; width: 300px; height: 80px; background: white; box-shadow: 0 4px 8px rgba(0,0,0,0.3); border-radius: 8px; overflow: hidden; z-index: 999;">
  <iframe 
    id="spotifyIframe"
    src=""
    width="100%" 
    height="100%" 
    frameborder="0" 
    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">
  </iframe>
</div>


<!-- Radar Buttons -->
<div id="radar-container">
  <div id="radar-map"></div>
  <div id="radar-controls">
    <button id="radar-toggle">Show Radar</button>
    <button id="settings-button">Change Settings</button>
    <button id="stocks-toggle">Show CNBC</button>
    <button id="news-toggle">News</button>
    <button id="tetris-toggle">Play Tetris üéÆ</button>
    <button id="carrot-toggle">Carrot Rain ü•ï</button>
    <button id="treat-toggle">Give Treat</button>
    <button id="dew-toggle">Give Mt Dew</button>
    <button id="spotifyPlayButton">üéß</button> <!-- << renamed this -->
    <button id="spotifyStopButton" style="display: none;">Stop Music üö´</button> <!-- << new stop button -->
  </div>
</div>

<script>
  const spotifyPlayButton = document.getElementById('spotifyPlayButton');
  const spotifyStopButton = document.getElementById('spotifyStopButton');
  const spotifyPlayer = document.getElementById('spotifyPlayer');
  const spotifyIframe = document.getElementById('spotifyIframe');

  spotifyPlayButton.addEventListener('click', () => {
    spotifyIframe.src = "https://open.spotify.com/embed/artist/4MCBfE4596Uoi2O4DtmEMz?utm_source=generator";
    spotifyPlayer.style.display = 'block';
    spotifyPlayButton.style.display = 'none';
    spotifyStopButton.style.display = 'inline-block';
  });

  spotifyStopButton.addEventListener('click', () => {
    spotifyIframe.src = ""; // Clear the iframe to stop music
    spotifyPlayer.style.display = 'none';
    spotifyPlayButton.style.display = 'inline-block';
    spotifyStopButton.style.display = 'none';
  });
</script>


<!-- Companions -->
<div id="animal-companion">
  <div class="animal-body">
    <div class="animal-face"></div>
    <div class="animal-legs">
      <div class="animal-leg"></div><div class="animal-leg"></div><div class="animal-leg"></div><div class="animal-leg"></div>
    </div>
  </div>
  <div class="animal-hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
  <div class="animal-message">Hello!</div>
</div>

<div id="bunny-container">
  <div id="bunny-companion">
    <div class="bunny-body">
      <div class="bunny-ears">
        <div class="bunny-ear left"></div><div class="bunny-ear right"></div>
      </div>
      <div class="bunny-face">
        <div class="bunny-eyes">
          <div class="bunny-eye"></div><div class="bunny-eye"></div>
        </div>
        <div class="bunny-nose"></div>
      </div>
    </div>
    <div class="bunny-message">ü•ï!</div>
    <div class="bunny-carrot"></div>
  </div>
</div>

<div id="dog-container">
  <div id="dog-companion">
    <div class="dog-body">
      <div class="dog-ears">
        <div class="dog-ear left"></div><div class="dog-ear right"></div>
      </div>
      <div class="dog-face">
        <div class="dog-eyes">
          <div class="dog-eye"></div><div class="dog-eye"></div>
        </div>
        <div class="dog-nose"></div>
      </div>
    </div>
    <div class="dog-message">ü¶¥!</div>
  </div>
</div>
<!-- Stocks Container -->
<div id="stocks-container" style="display:none;">
  <iframe id="stocks-iframe" src="https://livenewschat.eu/stocks/?autoplay=0" allow="autoplay; fullscreen" allowfullscreen></iframe>
</div>

<!-- Scripts -->
<script src="libs/jquery.min.js" defer></script>
<script src="libs/moment-with-locales.min.js" defer></script>
<script src="js/rgb-background.js" defer></script>
<script src="js/app.js" defer></script>
<script src="js/carrot.js" defer></script>
<script src="js/tetris.js" defer></script>

<script>
  document.getElementById('playButton').addEventListener('click', function() {
    document.getElementById('spotifyPlayer').style.display = 'block';
    this.style.display = 'none'; // optional: hide the button after clicking
  });
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const carrotToggle = document.getElementById('carrot-toggle');
  if (carrotToggle) {
    carrotToggle.addEventListener('click', function() {
      document.body.classList.toggle('carrot-mode');
    });
  }

  const newsToggle = document.getElementById('news-toggle');
  const ticker = document.getElementById('news-ticker');
  const newsItems = document.getElementById('news-items');

  if (newsToggle && ticker && newsItems) {
    ticker.style.display = 'none';
    newsToggle.textContent = 'Show Headlines';

    function fetchGoogleNews() {
      fetch('https://api.allorigins.win/raw?url=https://news.google.com/rss?hl=en-US&gl=US&ceid=US:en')
        .then(response => response.text())
        .then(str => (new window.DOMParser()).parseFromString(str, "text/xml"))
        .then(data => {
          const items = data.querySelectorAll("item");
          const headlines = Array.from(items).slice(0, 10).map(item => item.querySelector("title").textContent);
          newsItems.innerHTML = headlines.join(' ü•ï ');

          // RESET animation
          newsItems.style.animation = 'none';
          void newsItems.offsetWidth;
          newsItems.style.animation = 'scrollNews 60s linear infinite';
        })
        .catch(error => {
          console.error('Error fetching Google News:', error);
          newsItems.innerHTML = "Failed to load news.";
        });
    }

    newsToggle.addEventListener('click', function() {
      const isHidden = window.getComputedStyle(ticker).display === 'none';
      if (isHidden) {
        fetchGoogleNews();
        ticker.style.display = 'block';
        newsToggle.textContent = 'Hide Headlines';
      } else {
        ticker.style.display = 'none';
        newsToggle.textContent = 'Show Headlines';
      }
    });
  }
});
</script>
<div id="emergency-overlay"></div>
<div id="emergency-message" style="display: none;">‚ö†Ô∏è TORNADO WARNING ‚ö†Ô∏è</div>
<button id="stop-button" style="display: none;">Stop Alert</button>
</body>
</html>
